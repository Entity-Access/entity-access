# Entity Access

Inspired from Entity Framework Core, Entity Access is ORM for JavaScript runtime such as Node, YantraJS.


# Project Status
1. Alpha

## Features
1. Unit of Work and Repository Pattern
2. Arrow function based query features
3. Automatic Migrations for missing schema - this is done for fast development and deployment.
4. Sql functions such as LIKE

## Upcoming Features
1. Postgres SQL Test cases
2. Include
3. OrderBy
4. Projection - Split query mode only

### Unit of Work

```typescript
const db = new ShoppingContext();
db.orders.add({
    orderDate: new Date(),
    userID,
    orderItems: [
        db.orderItems.add({
            productID,
            amount
        })
    ]
});

// save all in single transaction
await db.saveChanges();
```

### Arrow function based query features

Arrow function based query provides many benefits over tagged template literals or other fluent methods to build queries.
1. Arrow functions are easy to visualize.
2. You will get intellisense help to complete the query.
3. You will get errors if the wrong data types are compared or used in computations.
4. Change of property name will automatically refactor as typescript will keep references of where the property is used.

Simple Query
```typescript
const db = new ShoppingContext();

/// first parameter is set of parameters to pass to the query
/// the reason it is first, is to help in intellisense.

/// second parameter is an arrow function which returns a filter
const q = db.orders.where({ userID }, (params) => (order) => order.userID === p.userID);
```

Query with Like operator
```typescript
/// Find all orders for specified customer
/// Sql functions
const userName = `akash%`;
const q = db.orders.where({ userName },
    (params) =>
        (order) =>
            Sql.text.like(
                order.customer.userName,
                p.userName
            )
);
```

### Typed Configurations
```typescript
class ShoppingContext {
    products = this.model.register(Product);
    orders = this.model.register(Order);
    orderItems = this.model.register(OrderItem);
}

@Table("Products")
class Product {

    @Column({ key: true, autoGenerated: true })
    productID: number;

    orderItems: OrderItem[];
}

@Table("OrderItems")
class OrderItem {

    @Column({ key: true, autoGenerated: true })
    orderItemID: number;

    @Column()
    productID: number;

    @Column()
    orderID: number;

    /**
     * Following configuration declares everything
     * that will give compilation error if configured wrong.
    */
    @ForeignKey({
        key: (orderItem) => orderItem.productID,
        related: Product,
        relatedProperty:(product) => product.orderItems
    })
    product: Product;

}

```